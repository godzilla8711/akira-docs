AWSTemplateFormatVersion: 2010-09-09
Resources:
  AkiraDevInstance:
    # http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-instance.html
    Type: AWS::EC2::Instance
    Properties:
      ImageId: ami-55ef662f
      InstanceType: t2.micro
      KeyName: AkiraKeyPair
      IamInstanceProfile: !Ref DevInstanceProfile
      SecurityGroups:
        - !Ref AkiraDevSecurityGroup

  DevInstanceProfile:
    Type: AWS::IAM::InstanceProfile
    Properties:
      Path: /
      Roles:
        - S3FullAccess

  AkiraDevSecurityGroup:
    # http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ec2-security-group.html
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Development security group
      SecurityGroupIngress:
      - CidrIp: 0.0.0.0/0
        FromPort: 22
        IpProtocol: tcp
        ToPort: 22
      - IpProtocol: tcp
        FromPort: 80
        ToPort: 80
        CidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        FromPort: 443
        ToPort: 443
        CidrIp: 0.0.0.0/0

Outputs:
  PublicIP:
    Description: Public IP address of the web server
    Value:
      !GetAtt AkiraDevInstance.PublicIp
